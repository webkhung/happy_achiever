.row.plan-overview
  - plans.each do |plan|
    %div.text-center{ class: "span#{12 / plans.count}" }
      = link_to image_tag(plan.image_url, :class => 'img-polaroid schedule-thumb plan-large'), "#modal-plan#{plan.id}", { data: { toggle: "modal" }} if plan.image_url.present?
      %br
      This Week:
      %br
      = icon_for(:time, "Scheduled: #{time_spent_in_words(plan.minutes_scheduled)}")
      %br
      = icon_for(:time, "Spent: #{time_spent_in_words(plan.time_spent_last_week)}")

      %br
      Today
      = DateTime.now.to_date
      %ul.schedule-of-day
        = render partial: 'schedules/schedule', collection: plan.schedules_on(DateTime.now.to_date), locals: { mode: 'view', date: DateTime.now.to_date }
      %br
      Tomorrow
      = DateTime.tomorrow.to_date
      %ul.schedule-of-day
        = render partial: 'schedules/schedule', collection: plan.schedules_on(DateTime.now.tomorrow.to_date), locals: { mode: 'view', date: DateTime.now.tomorrow.to_date }

      - if (last_achievement = plan.last_achievement).present? && last_achievement.achieved_date > 3.day.ago
        = link_to("Attention!", "#modal-plan#{plan.id}", { data: { toggle: "modal" }, class: 'btn btn-mini btn-danger'} )

      .plan-overview.modal.hide.fade{ id: "modal-plan#{plan.id}" }
        .modal-header
          %button.close{  data: { dismiss: 'modal' } } Ã—
          %h2
            = image_tag plan.image_url, class: 'plan-small' if plan.image_url.present?
            #{plan.title}
        .modal-body
          .motivation
            = icon_for(:question)
            %span.look Why :
            = plan.purpose
            %br
            = icon_for(:frown)
            %span.look Fail to follow through :
            = plan.if_not_achieved
          .data
            = icon_for(:time, "Time scheduled this week: #{time_spent_in_words(plan.minutes_scheduled)}")
            %br
            = icon_for(:time, "Time spent this week: #{time_spent_in_words(plan.time_spent_last_week)}")
            %br

            - last_achievement = plan.last_achievement
            - if last_achievement.nil?
              You haven't done anything for this goal yet!
            - else
              - if last_achievement.achieved_date > 4.day.ago
                .alert.alert-block.alert-error.fade.in
                  %h4.alert-heading Oh Snap!
                  %p
                    You haven't done anything in this goal for too long.  Usually it is because the WHY is not big enough.
                    WHY do you want to achieve this goal?  What will you get if you achieve?
                    How will your life change if you achieve it?
                  %p
                    What happen if you cannot achieve?  What will you lose and miss?
                  %p
                    Imagine what you future will be and revise your WHY

                  =link_to('Change Your Why', edit_plan_path(plan), class: "btn btn-danger")
              - else
                = icon_for(:trophy, "Last achievement: #{last_achievement.task.description} on  #{last_achievement.achieved_date.strftime("%c  ")}")
                %span.label.label-success Good Job!

        .modal-footer
          .pull-left
            = link_to(icon_for(:file_alt, 'View Plan Details'), plan_path(plan))
            &nbsp;
            = link_to(icon_for(:edit, 'Edit'), edit_plan_path(plan))
          %button.btn{ data: { dismiss: 'modal' } } Close
